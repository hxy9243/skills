---
name: zettel-brainstormer
description: It reads from your local zettelkasten notes, find a random idea, and find references by links or tags, then expand the idea with the references.
---

# Zettel Brainstormer ðŸ§ 

This skill formalizes the process of taking a rough idea or draft and enriching it with deep research, diverse perspectives, and structured brainstorming.

## New Dual-Stage Workflow

This skill now supports a 3-stage pipeline to balance cost and quality:

1) Preprocess & Extraction (cheap model)

- Run a lightweight extraction step to produce:
  - Short bullet-point keypoints
  - Candidate headings and tags
  - Minimal bibliography/search queries
  - **Wikilinked documents** (follows [[wikilinks]] N levels deep, up to M total docs)
  - **Tag-similar documents** (finds notes with overlapping tags)
- Output format (JSON): `{"headlines":[], "points":[], "linked_docs":[], "tag_similar_docs":[]}`.

2) Subagent: Read and preprocess each documents

Use a fast model to read and preprocess each document gathered from Stage 1. For each document in the linked_docs:

- Read the document.
- Find out the relevance of the document to the seed note, discard if not relevant.
- Summarize the document if too long.
- Output format in Markdown text.

3) Draft & Humanize (pro model)

- Use a pro model (configurable; default: openai/gpt-5.2) to gather the markdown output from all pre-processed documents from subagents in stage 2.
- Post-process the draft with if exists, to make voice natural. Use the `humanizer` skill if available.
- Add proper Obsidian properties, tags, and links. Use the `obsidian` skill if available. Pick up properties and follow examples from other obsidian notes to keep the style consistent.

## Files & Scripts

This skill includes the following resources under the skill folder:

- scripts/preprocess.py  -- extract key points, wikilinks, queries, and filters relevance
- scripts/draft.py       -- call pro model with outline + references, produce final Markdown
- scripts/obsidian_utils.py -- shared utilities for wikilink extraction
- references/templates.md -- output templates, headline/lead examples, tone guide
- config/models.example.json  -- example configuration file for user-selectable model and research settings

## Configuration & Setup

**First Run Setup**:
Before using this skill, you must run the setup script to configure models and directories.

```bash
python scripts/setup.py
```

This will create `config/models.json` with your preferences. You can press ENTER to accept defaults.

**Configuration Fields**:
- `pro_model`: The model used for drafting (defaults to agent's current model)
- `preprocess_model`: Cheap model for extraction (defaults to agent's current model)
- `zettel_dir`: Path to your Zettelkasten notes
- `output_dir`: Path where drafts should be saved
- `search_skill`: Which search skill to use for web/X research (web_search, brave_search, or none)
- `link_depth`: How many levels deep to follow [[wikilinks]] (N levels, default: 2)
- `max_links`: Maximum total linked notes to include (M links, default: 10)

To change settings later, you can edit `config/models.json` directly or re-run `scripts/setup.py`.

**Note**: When using this skill, the agent will inform you of the current link_depth and max_links settings in the final result.


## Usage

- Trigger when user asks: "brainstorm X", "expand this draft", "research and add notes to <path>".
- Example workflow (pseudo):
  1. If not configured, config will use agent's current model by default (or run `python scripts/setup.py` for custom settings)
  2. Pick a random seed note from zettelkasten
  3. Preprocess: `scripts/preprocess.py --input <seed_note> --output /tmp/outline.json --filter`
     - This automatically extracts wikilinks (depth=N, max=M) and tag-similar docs.
     - Generates search queries using `preprocess_model`.
     - Filters out irrelevant docs using `preprocess_model` (if `--filter` is used).
  4. Research using configured search_skill (if not "none")
  5. Draft: `scripts/draft.py --outline /tmp/outline.json --model <pro_model> --out /tmp/draft.md`
  6. (Optional) Humanize: `humanizer --in /tmp/draft.md --out /tmp/draft.human.md`
  7. Append result to seed note or save to output_dir
  8. **Inform user**: "Extracted wikilinks with depth=N, max_links=M using search_skill=<skill>"

## Notes for maintainers

- Keep preprocess outputs small (200-600 tokens) to save cost.
- Ensure all external links are included in the `References` section with full titles and URLs.
- When appending, always include a timestamp and short provenance line (e.g., "Generated by writing-brainstormer; preprocessed with kimi-k2.5; draft with gpt-5.2").

## Example Output Format (unchanged)

```markdown
# PROMPT FOR AGENT

**System**:
You are an expert writer and researcher.

...

**User**:

    Please write a comprehensive draft based on the following outline and context.

    # Title: The Power of Connected Thought

    # Key Points to Cover:
    [
      "# Seed Note: The Power of Connected Thought",
      "I want to explore how connecting ideas leads to better thinking.",
      "I have some notes on [[Example Note A]] and [[Example Note B]].",
      ...
    ]

    # Context Material:
    ## Referenced Notes
    ### Note: Example Note A
    **Relevance: 5/10**
    ...
```

*If API key is present, the output will be a full Markdown draft.*
